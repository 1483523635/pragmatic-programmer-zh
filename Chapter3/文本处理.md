# 文本处理
<!-- 2020.03.26 -->

实用主义程序员处理文本的方式与木工塑造木材的方式相同。在前面的小节中，我们讨论了一些我们使用的特定工具shell、编辑器和调试器。这些工具类似于木工的凿子、锯子和刨子，专门用来做好一两项工作。但是，有时我们需要执行一些基本工具集不易处理的转换。我们需要一个通用的文本处理工具。

文本处理语言对于编程来说就像槽刨对于木工一样。他们吵闹，凌乱，有点野蛮。用它们犯错误，整件东西都会被毁掉。有些人发誓他们在工具箱里没有位置。但在右手边，槽刨和文本处理语言都可以非常强大和通用。你可以很快地修剪成形状，做关节，雕刻。使用得当，这些工具有惊人的技巧和微妙之处。但他们需要时间来掌握。

幸运的是，有很多优秀的文本处理语言。Unix 开发人员（这里包括 macOS 用户）通常喜欢使用命令 shell 的强大功能，并使用 awk 和 sed 等工具进行增强。喜欢更结构化工具的人可能更喜欢 Perl、Python 或 Ruby 等语言。

这些语言是重要的使能技术。使用它们，你可以快速破解实用程序和原型创意工作，使用传统语言可能需要5到10倍的时间。这个倍增因子对于我们所做的实验来说至关重要。花30分钟尝试一个疯狂的想法比花5个小时要好得多。花一天时间自动化一个项目的重要组成部分是可以接受的；花一周时间可能不是。在他们的《编程实践》（The Practice of Programming）一书中，Kernighan 和 Pike 用五种不同的语言构建了同一个程序。Perl 版本是最短的（17行，而 C 版本是150行）。使用 Perl，您可以操作文本、与程序交互、通过网络交谈、驱动网页、执行任意精度的算术运算，以及编写看起来像斯努比咒骂的程序。

---
## 提示 35 学习一门文本处理语言
---

为了展示文本处理语言的广泛适用性，以下是我们使用 Ruby 和 Python 所做的一些与本手册的创建有关的示例。

### _建立书_

  实用书架的构建系统是用 Ruby 编写的。作者，编辑，布局人员和支持人员使用 Rake 任务来协调 PDF 和电子书的构建。

### _代码包含和突出显示_

  我们认为重要的是，书中介绍的任何代码都应先经过测试。本书中的大多数代码都包含在内。但是，使用 DRY 原理(请参阅话题 9 [_重复的恶魔_](../Chapter2/重复的恶魔.md）)，我们不想将经过测试的程序中的代码行复制并粘贴到本书中。那将意味着代码是重复的，实际上保证了我们在更改相应程序后忘记更新示例。对于某些示例，我们也不想让您感到厌倦所有使示例得以编译和运行的框架代码。我们转向 Ruby。在对书籍进行格式设置时，将调用一个相对简单的脚本-它提取源文件的命名段，进行语法突出显示，然后将结果转换为我们使用的排版语言。

### _网站更新_

  我们有一个简单的脚本，可以部分编译书籍，提取目录，然后将其上传到我们网站上的书籍页面。我们还有一个脚本，可提取书中的各个部分并将其作为样本上传。

### _包括方程式_

  有一个 Python 脚本可将 LaTeX 数学标记转换为格式正确的文本。

### _索引生成_

  大多数索引都是作为单独的文档创建的（如果文档发生更改，这将使维护变得很困难）。我们的标记在文本本身中，并且 Ruby 脚本整理和格式化条目。等等。实际上，实用书架是围绕文本处理构建的。而且，如果您遵循我们的建议以纯文本形式保存内容，那么使用这些语言来操纵该文本将带来很多好处。

## 相关话题包括
- 话题 17 [_shell 游戏_](./shell.md)
- 话题 16 [_纯文本的力量_](./纯文本的力量.md)

## 练习

### 练习 11

您正在重写一个将 YAML 用作配置语言的应用程序。您的公司现在已经对 JSON 进行了标准化，因此您有一堆需要转换为 .JSON 的 .yaml 文件。编写一个脚本，获取一个目录并将每个 .yaml 文件转换为相应的 .json 文件（因此database.yaml 变为 database.json，内容是有效的 json）。
