# 配置
<!-- 2020.04.08 -->

> _把你所有的事都摆在它该有的的位置，每一部分都各有各的时候。_
>
> _-- 本杰明富兰克林，自传_

当代码依赖于应用程序启动后可能更改的值时，请将这些值保留在应用程序外部。当您的应用程序将在不同的环境中运行，并可能为不同的客户运行时，请将环境和特定于客户的值保留在应用程序之外。这样，您就可以对应用程序进行参数化；代码是根据它运行的位置定制的。

---
## 提示 55 使用外部配置参数化应用程序
---

您可能希望放入配置数据中的常见内容包括：

- 外部服务的凭据（数据库，第三方API等）
- 日志记录级别和目的地
- 应用程序使用的端口，IP地址，计算机和群集名称
- 特定于环境的验证参数
- 外部设置的参数，例如税率
- 特定于站点的格式详细信息
- 许可证密钥

基本上，寻找可以更改的内容，您可以在代码主体之外表达这些内容，然后将其放入一些配置存储区中。

## 静态配置
许多框架和许多自定义应用程序将配置保留在平面文件或数据库表中。如果信息是平面文件，则趋势是使用某些现成的纯文本格式。当前，YAML 和 JSON 很流行。有时，用脚本语言编写的应用程序使用专用的源代码文件，专用于仅包含配置。如果信息是结构化的，并且可能由客户更改（例如，销售税率），则最好将其存储在数据库表中。而且，当然，您可以同时使用这两种方法，并根据用途拆分配置信息。

无论使用哪种形式，通常都会在应用程序启动时将配置作为数据结构读入应用程序。 通常，此数据结构是全局的，认为这会使代码的任何部分更容易获得其所拥有的值。

我们希望您不要这样做。 而是将配置信息包装在一个（瘦）API后面。 这使您的代码与配置表示的细节分离。

---
### 别做过头了
在本书的第一版中，我们建议以类似的方式使用配置而不是代码，但是显然在我们的说明中应该更加具体。 任何建议都可以采取极端措施或不当使用，因此这里有一些注意事项：

别做过头了。 我们的一个早期客户决定应用程序中的每个字段都应可配置。 结果，即使是最小的更改也要花费数周的时间，因为您必须同时实现字段和所有管理代码才能保存和编辑它。 他们手上有_40,000_个配置变量和一个编码梦魇。

不要懒惰地推动配置决策。 如果对于某项功能是否应该以这种方式工作还是应该由用户选择进行真正的辩论，请尝试一种方式并获得有关决策是否正确的反馈。

---

## 配置即服务
虽然静态配置很常见，但我们目前倾向于其他方法。我们仍然希望将配置数据保留在应用程序外部，而不是将其保存在平面文件或数据库中，我们希望将其存储在服务API的后面。这有很多好处：

- 多个应用程序可以共享配置信息，而身份验证和访问控制限制了每个应用程序可以看到的内容
- 可以全局进行配置更改
- 可以通过专门的UI维护配置数据
- 配置数据变为动态

最后一点，即配置应该是动态的，对于我们向高可用性应用程序迈进至关重要。我们必须停止并重新启动应用程序才能更改单个参数的想法已过时。使用配置服务，应用程序的组件可以注册以通知其使用的参数的更新，并且如果更改了它们，则服务可以向它们
发送包含新值的消息。

无论采用哪种形式，配置数据都会驱动应用程序的运行时行为。当配置值更改时，无需重建代码。

## 不要写渡渡鸟代码
如果没有外部配置，您的代码将无法适应或灵活。 这是坏事吗？ 好吧，在现实世界中，不适应的物种将会死亡。

渡渡鸟无法适应毛里求斯岛上人类和牲畜的存在，并迅速灭绝。这是第一个被人类灭绝的物种灭绝。

不要让您的项目（或您的职业生涯）像渡渡鸟一样前进。

## 相关内容包括

- 话题 14 [_域语言_](../Chapter2/域语言.md)
- 话题 28 [_解耦_](./解耦.md)
- 话题  9 [_重复的恶魔_](../Chapter2/重复的恶魔.md)
- 话题 16 [_纯文本的力量_](../Chapter3/纯文本的力量.md)
